# Powerlevel10k Configuration Reference

Complete guide to configuring Powerlevel10k for maximum performance and customization.

## File Structure

```
~/.zshrc                 # Main config, loads P10k
~/.p10k.zsh              # P10k configuration (generated by wizard)
~/.cache/p10k-instant-prompt-*.zsh  # Instant prompt cache
~/.cache/gitstatus/      # gitstatusd binary cache
```

## Installation Methods

### Oh My Zsh

```bash
git clone --depth=1 https://github.com/romkatv/powerlevel10k.git \
  ${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/themes/powerlevel10k

# In .zshrc
ZSH_THEME="powerlevel10k/powerlevel10k"
```

### Zinit

```zsh
zinit ice depth=1
zinit light romkatv/powerlevel10k
```

### Antigen

```zsh
antigen theme romkatv/powerlevel10k
```

### Manual

```bash
git clone --depth=1 https://github.com/romkatv/powerlevel10k.git ~/powerlevel10k
echo 'source ~/powerlevel10k/powerlevel10k.zsh-theme' >> ~/.zshrc
```

## Instant Prompt

### Setup (Required for Best Performance)

Add at the **very beginning** of `~/.zshrc`:

```zsh
# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi
```

### How It Works

1. P10k saves prompt state to cache file
2. On shell start, cache is loaded instantly (~10ms)
3. Real prompt calculated in background
4. Seamless transition when ready

### Verbosity Levels

```zsh
# In ~/.p10k.zsh
typeset -g POWERLEVEL9K_INSTANT_PROMPT=verbose  # Show warnings
typeset -g POWERLEVEL9K_INSTANT_PROMPT=quiet    # Suppress warnings
typeset -g POWERLEVEL9K_INSTANT_PROMPT=off      # Disable feature
```

## Prompt Segments

### Left Prompt Elements

```zsh
typeset -g POWERLEVEL9K_LEFT_PROMPT_ELEMENTS=(
  # Line 1
  os_icon                 # OS identifier
  dir                     # Current directory
  vcs                     # Git status
  # Line 2
  newline                 # Line break
  prompt_char             # Prompt symbol (changes on error)
)
```

### Right Prompt Elements

```zsh
typeset -g POWERLEVEL9K_RIGHT_PROMPT_ELEMENTS=(
  # Line 1
  status                  # Exit code of last command
  command_execution_time  # Duration of last command
  background_jobs         # Background job indicator
  direnv                  # direnv status
  virtualenv              # Python venv
  pyenv                   # Python version
  nodenv                  # Node.js version
  nvm                     # NVM version
  kubecontext             # Kubernetes context
  terraform               # Terraform workspace
  aws                     # AWS profile
  azure                   # Azure account
  gcloud                  # GCP project
  context                 # user@hostname
  time                    # Current time
  # Line 2
  newline
)
```

### Available Segments

| Segment | Description |
|---------|-------------|
| `os_icon` | Operating system icon |
| `dir` | Current directory |
| `vcs` | Version control (git) |
| `prompt_char` | `❯` or `❮` based on exit code |
| `status` | Exit code if non-zero |
| `command_execution_time` | Command duration |
| `background_jobs` | Background job count |
| `virtualenv` | Python virtual environment |
| `anaconda` | Conda environment |
| `pyenv` | pyenv Python version |
| `nodenv` | nodenv Node version |
| `nvm` | nvm Node version |
| `rbenv` | rbenv Ruby version |
| `kubecontext` | Kubernetes context |
| `terraform` | Terraform workspace |
| `aws` | AWS profile |
| `azure` | Azure subscription |
| `gcloud` | GCP project |
| `docker_context` | Docker context |
| `context` | user@hostname |
| `time` | Current time |
| `battery` | Battery status |
| `wifi` | WiFi signal |
| `vpn_ip` | VPN indicator |

## Directory Configuration

```zsh
# Truncation strategy
typeset -g POWERLEVEL9K_SHORTEN_STRATEGY=truncate_to_unique
# Options: truncate_to_unique, truncate_from_right, truncate_to_last,
#          truncate_absolute, truncate_with_folder_marker

# Directory length
typeset -g POWERLEVEL9K_SHORTEN_DIR_LENGTH=3

# Anchor folders (always show full name)
typeset -g POWERLEVEL9K_SHORTEN_FOLDER_MARKER='(.git|.svn|.terraform)'

# Show full path in repos
typeset -g POWERLEVEL9K_DIR_TRUNCATE_BEFORE_MARKER=true

# Home directory symbol
typeset -g POWERLEVEL9K_HOME_ICON='~'

# Directory colors
typeset -g POWERLEVEL9K_DIR_FOREGROUND=31
typeset -g POWERLEVEL9K_DIR_BACKGROUND=none
```

## Git (VCS) Configuration

```zsh
# Enable git status
typeset -g POWERLEVEL9K_VCS_BACKENDS=(git)

# Icons
typeset -g POWERLEVEL9K_VCS_BRANCH_ICON='\uF126 '  #
typeset -g POWERLEVEL9K_VCS_UNTRACKED_ICON='?'
typeset -g POWERLEVEL9K_VCS_UNSTAGED_ICON='!'
typeset -g POWERLEVEL9K_VCS_STAGED_ICON='+'

# Show remote tracking
typeset -g POWERLEVEL9K_VCS_GIT_HOOKS=(vcs-detect-changes git-untracked git-aheadbehind git-stash git-remotebranch)

# Performance: disable for large repos
typeset -g POWERLEVEL9K_VCS_MAX_INDEX_SIZE_DIRTY=1000

# Disable git status completely (fastest)
# typeset -g POWERLEVEL9K_DISABLE_GITSTATUS=true

# Colors for states
typeset -g POWERLEVEL9K_VCS_CLEAN_FOREGROUND=76
typeset -g POWERLEVEL9K_VCS_MODIFIED_FOREGROUND=178
typeset -g POWERLEVEL9K_VCS_UNTRACKED_FOREGROUND=178
```

## Command Execution Time

```zsh
# Minimum duration to show (seconds)
typeset -g POWERLEVEL9K_COMMAND_EXECUTION_TIME_THRESHOLD=3

# Precision (decimal places)
typeset -g POWERLEVEL9K_COMMAND_EXECUTION_TIME_PRECISION=2

# Format
typeset -g POWERLEVEL9K_COMMAND_EXECUTION_TIME_FORMAT='d h m s'

# Colors
typeset -g POWERLEVEL9K_COMMAND_EXECUTION_TIME_FOREGROUND=yellow
typeset -g POWERLEVEL9K_COMMAND_EXECUTION_TIME_BACKGROUND=none
```

## Transient Prompt

Cleans up previous prompts for cleaner scrollback:

```zsh
# Enable transient prompt
typeset -g POWERLEVEL9K_TRANSIENT_PROMPT=always
# Options: off, always, same-dir

# What to show in transient prompt
typeset -g POWERLEVEL9K_TRANSIENT_PROMPT_ELEMENTS=(prompt_char)
```

## Kubernetes Context

```zsh
# Show kubecontext
typeset -g POWERLEVEL9K_KUBECONTEXT_SHOW_ON_COMMAND='kubectl|helm|kubens|kubectx|oc|istioctl|kogito|k9s|helmfile|flux|fluxctl|stern'

# Hide default context
typeset -g POWERLEVEL9K_KUBECONTEXT_DEFAULT_CONTEXT_PATTERN='default'

# Shorten context names
typeset -g POWERLEVEL9K_KUBECONTEXT_SHORTEN=(
  'gke_*_*_*' 'gke-$4'
  'arn:aws:eks:*:*:cluster/*' 'eks-$4'
)

# Colors per context pattern
typeset -g POWERLEVEL9K_KUBECONTEXT_PROD_FOREGROUND=red
typeset -g POWERLEVEL9K_KUBECONTEXT_CLASSES=(
  '*prod*' PROD
  '*staging*' STAGING
  '*' DEFAULT
)
```

## AWS Profile

```zsh
# Show AWS profile
typeset -g POWERLEVEL9K_AWS_SHOW_ON_COMMAND='aws|awless|terraform|pulumi|terragrunt'

# Colors per profile
typeset -g POWERLEVEL9K_AWS_CLASSES=(
  '*prod*' PROD
  '*dev*' DEV
  '*' DEFAULT
)
typeset -g POWERLEVEL9K_AWS_PROD_FOREGROUND=red
typeset -g POWERLEVEL9K_AWS_DEV_FOREGROUND=green
```

## Prompt Styles

### Rainbow (Colorful Background)

```zsh
typeset -g POWERLEVEL9K_MODE=nerdfont-complete
typeset -g POWERLEVEL9K_LEFT_SEGMENT_SEPARATOR='\uE0B0'
typeset -g POWERLEVEL9K_RIGHT_SEGMENT_SEPARATOR='\uE0B2'
```

### Lean (No Background)

```zsh
typeset -g POWERLEVEL9K_MODE=nerdfont-complete
typeset -g POWERLEVEL9K_LEFT_SEGMENT_SEPARATOR=''
typeset -g POWERLEVEL9K_RIGHT_SEGMENT_SEPARATOR=''
typeset -g POWERLEVEL9K_LEFT_SUBSEGMENT_SEPARATOR=' '
typeset -g POWERLEVEL9K_RIGHT_SUBSEGMENT_SEPARATOR=' '
```

### Pure Style (Minimal)

```zsh
typeset -g POWERLEVEL9K_LEFT_PROMPT_ELEMENTS=(dir vcs newline prompt_char)
typeset -g POWERLEVEL9K_RIGHT_PROMPT_ELEMENTS=()
typeset -g POWERLEVEL9K_PROMPT_CHAR_OK_{VIINS,VICMD,VIVIS,VIOWR}_FOREGROUND=green
typeset -g POWERLEVEL9K_PROMPT_CHAR_ERROR_{VIINS,VICMD,VIVIS,VIOWR}_FOREGROUND=red
```

## Performance Optimization

### Fastest Configuration

```zsh
# Minimal segments
typeset -g POWERLEVEL9K_LEFT_PROMPT_ELEMENTS=(dir vcs newline prompt_char)
typeset -g POWERLEVEL9K_RIGHT_PROMPT_ELEMENTS=(status command_execution_time)

# Disable slow features
typeset -g POWERLEVEL9K_VCS_MAX_INDEX_SIZE_DIRTY=100
typeset -g POWERLEVEL9K_DISABLE_CONFIGURATION_WIZARD=true

# Use lean style (no separators to render)
typeset -g POWERLEVEL9K_LEFT_SEGMENT_SEPARATOR=''
typeset -g POWERLEVEL9K_RIGHT_SEGMENT_SEPARATOR=''
```

### Disable Specific Segments

```zsh
# Disable via content
typeset -g POWERLEVEL9K_TIME_CONTENT_EXPANSION=''

# Or remove from elements array entirely
```

## Reconfiguration

```bash
# Run wizard again
p10k configure

# Reload config without restart
source ~/.p10k.zsh

# Reset everything
rm ~/.p10k.zsh
exec zsh
```

## Common Issues

### Fonts Not Displaying

```bash
# Install Nerd Font
brew tap homebrew/cask-fonts
brew install --cask font-meslo-lg-nerd-font

# Set in terminal emulator preferences
```

### Instant Prompt Errors

```zsh
# Add before instant prompt block
typeset -g POWERLEVEL9K_INSTANT_PROMPT=quiet
```

### Slow in Large Repos

```zsh
# Reduce dirty check threshold
typeset -g POWERLEVEL9K_VCS_MAX_INDEX_SIZE_DIRTY=100

# Or disable dirty check entirely
typeset -g POWERLEVEL9K_VCS_MAX_INDEX_SIZE_DIRTY=-1
```
