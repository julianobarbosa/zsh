#!/usr/bin/env bash
# .envrc - ArgoCD environment configuration
# vim: set ft=bash:

# Source the parent directory's .envrc (inherits Dev environment)
source_up_if_exists

# Load environment variables from .env file
# Generated by 1Password (named pipe) - see: https://developer.1password.com/docs/environments/local-env-file
if [[ -e .env ]]; then
  while IFS= read -r line || [[ -n "$line" ]]; do
    # Skip comments and empty lines
    [[ -z "$line" || "$line" =~ ^# ]] && continue
    # Export the variable
    export "$line"
  done < .env
fi

# Load local overrides (not committed to git)
dotenv_if_exists .env.local

# Python virtual environment using uv
# Creates .venv if it doesn't exist
VIRTUAL_ENV="${PWD}/.venv"
if [[ ! -d "$VIRTUAL_ENV" ]]; then
    log_status "Creating virtual environment with uv..."
    uv venv "$VIRTUAL_ENV"
fi


# Status reminders
log_status "KUBECONFIG: ${KUBECONFIG:-not set}"
log_status "SENTRY_ORG: ${SENTRY_ORG:-not set}"
