# Development Guide

> Generated by BMAD Document Project Workflow | 2025-12-13

## Prerequisites

- **macOS 12 (Monterey)** or newer
- **Zsh shell** (pre-installed on modern macOS)
- **Git** for version control
- **Text editor** (VS Code, Vim, etc.)

## Development Setup

### 1. Clone the Repository

```bash
git clone https://github.com/julianobarbosa/zsh.git
cd zsh
```

### 2. Install in Development Mode

Development mode uses symlinks instead of copies, allowing immediate testing of changes:

```bash
zsh install.sh --dev
```

This creates:
- `~/.local/bin/zsh-tool/` - Installation directory (symlinked to repo)
- `~/.config/zsh-tool/` - Configuration directory

### 3. Reload Shell

```bash
exec zsh
```

## Project Structure

```
lib/
├── core/utils.zsh       # Shared utilities - edit here for common functions
├── install/             # Installation modules
├── update/              # Update operations
├── restore/             # Backup & restore
├── git/                 # Git integration
└── integrations/        # Atuin, Amazon Q
```

## Development Workflow

### Making Changes

1. **Edit files in `lib/`** - Changes are immediately available (dev mode)
2. **Test your changes** - Run the affected commands
3. **Run tests** - Ensure nothing is broken

### Testing

```bash
# Run all tests
cd tests
zsh run-all-tests.sh

# Run specific test file
zsh test-amazon-q.zsh
```

### Code Style

- Use `#!/usr/bin/env zsh` shebang
- Follow existing naming conventions (`_zsh_tool_*` for internal functions)
- Use the logging system from `utils.zsh`:
  ```zsh
  _zsh_tool_log INFO "Message here"
  _zsh_tool_log ERROR "Error message"
  ```

## Module Development

### Adding a New Module

1. Create file in appropriate directory (e.g., `lib/install/mymodule.zsh`)
2. Add source line to `install.sh` loader section
3. Follow existing module patterns:

```zsh
#!/usr/bin/env zsh
# Module description

# Public function (exposed to users)
zsh-tool-mycommand() {
  _zsh_tool_log INFO "Running mycommand..."
  # Implementation
}

# Internal function (prefixed with underscore)
_mymodule_helper() {
  # Helper implementation
}
```

### Adding Tests

1. Create test file in `tests/` directory
2. Follow existing test patterns
3. Add to `run-all-tests.sh` if needed

## Configuration

### Team Configuration (`templates/config.yaml`)

```yaml
plugins:
  - git
  - docker
  - kubectl

themes:
  default: "robbyrussell"

aliases:
  - name: "gs"
    command: "git status"
```

### User Configuration (`~/.config/zsh-tool/config.yaml`)

Users can customize their local config without affecting the repo.

## Debugging

### Enable Debug Logging

```bash
export ZSH_TOOL_LOG_LEVEL=DEBUG
```

### View Logs

```bash
cat ~/.config/zsh-tool/logs/zsh-tool.log
```

### Common Issues

| Issue | Solution |
|-------|----------|
| Changes not reflected | Ensure dev mode installed, reload shell |
| Permission errors | Check file permissions on lib/ files |
| Module not loading | Verify source line in install.sh |

## Build & Release

### Version Updates

1. Update version in `templates/config.yaml`
2. Update `CHANGELOG.md`
3. Create git tag: `git tag -a v1.x.x -m "Release v1.x.x"`

### Testing Before Release

```bash
# Test fresh install
zsh install.sh  # (non-dev mode)

# Verify all commands work
zsh-tool-install
zsh-tool-update
zsh-tool-backup create
```

## Contributing

1. Fork the repository
2. Create a feature branch: `git checkout -b feature/my-feature`
3. Make changes with tests
4. Submit a pull request

See [CONTRIBUTING.md](../CONTRIBUTING.md) for detailed guidelines.

## Related Documentation

- [Source Tree Analysis](./source-tree-analysis.md) - Detailed code structure
- [Architecture](./solution-architecture.md) - Technical design decisions
- [PRD](./PRD.md) - Product requirements and roadmap
